--- a/canohost.c	
+++ a/canohost.c	
@@ -321,6 +321,21 @@ clear_cached_addr(void)
 	cached_port = -1;
 }
 
+void set_remote_ipaddr(void) {
+	if (canonical_host_ip != NULL)
+		free(canonical_host_ip);
+
+	if (packet_connection_is_on_socket()) {
+		canonical_host_ip =
+		    get_peer_ipaddr(packet_get_connection_in());
+		if (canonical_host_ip == NULL)
+			cleanup_exit(255);
+	} else {
+		/* If not on socket, return UNKNOWN. */
+		canonical_host_ip = xstrdup("UNKNOWN");
+	}
+}
+
 /*
  * Returns the IP-address of the remote host as a string.  The returned
  * string must not be freed.
@@ -330,17 +345,9 @@ const char *
 get_remote_ipaddr(void)
 {
 	/* Check whether we have cached the ipaddr. */
-	if (canonical_host_ip == NULL) {
-		if (packet_connection_is_on_socket()) {
-			canonical_host_ip =
-			    get_peer_ipaddr(packet_get_connection_in());
-			if (canonical_host_ip == NULL)
-				cleanup_exit(255);
-		} else {
-			/* If not on socket, return UNKNOWN. */
-			canonical_host_ip = xstrdup("UNKNOWN");
-		}
-	}
+	if (canonical_host_ip == NULL)
+		set_remote_ipaddr();
+
 	return canonical_host_ip;
 }
 
--- a/canohost.h	
+++ a/canohost.h	
@@ -13,6 +13,7 @@ 
  */
 
 const char	*get_canonical_hostname(int);
+void		 set_remote_ipaddr(void);
 const char	*get_remote_ipaddr(void);
 const char	*get_remote_name_or_ip(u_int, int);
 
--- a/sshconnect.c	
+++ a/sshconnect.c	
@@ -62,6 +62,7 @@ 
 #include "roaming.h"
 #include "ssh2.h"
 #include "version.h"
+#include "canohost.h"
 
 char *client_version_string = NULL;
 char *server_version_string = NULL;
@@ -171,6 +172,7 @@ ssh_proxy_fdpass_connect(const char *host, u_short port,
 	packet_set_connection(sock, sock);
 	packet_set_timeout(options.server_alive_interval,
 	    options.server_alive_count_max);
+	set_remote_ipaddr();
 
 	return 0;
 }
@@ -493,6 +495,7 @@ ssh_connect_direct(const char *host, struct addrinfo *aitop,
 	packet_set_connection(sock, sock);
 	packet_set_timeout(options.server_alive_interval,
 	    options.server_alive_count_max);
+	set_remote_ipaddr();
 
 	return 0;
 }

